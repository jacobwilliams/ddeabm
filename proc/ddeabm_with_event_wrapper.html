<!-- -*- mode: jinja2 -*- -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
      <meta name="description" content="Modern Fortran Implementation of the DDEABM Adams-Bashforth-Moulton ODE Solver">
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>ddeabm_with_event_wrapper &ndash; ddeabm</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
      <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>
  </head>

  <body>

    <!-- Fixed navbar -->
    <div class="container-fluid mb-sm-4 mb-xl-2">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
          <a class="navbar-brand" href="../index.html">ddeabm </a>
          <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar"
                  aria-expanded="false" aria-controls="navbar" aria-label="Toggle navigation">
                  <span class="navbar-toggler-icon">
          </button>

          <div id="navbar" class="navbar-collapse collapse">
            <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" href="../sourcefile/ddeabm_module.f90.html">Source File</a>
                  </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/modules.html">Modules</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/procedures.html">Procedures</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/absint.html">Abstract Interfaces</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="../lists/types.html">Derived Types</a>
                </li>
            </ul>
              <div class="d-flex align-items-end flex-grow-1">
                <form action="../search.html" role="search" class="ms-auto">
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
                </form>
              </div>
          </div><!--/.nav-collapse -->
        </div>
      </nav>
    </div>

    <div class="container">
  <div class="row">
    <h1>ddeabm_with_event_wrapper
      <small>Subroutine</small>
      
    </h1>
      <div class="container p-2 mb-4 bg-light border rounded-3">
    <div class="row align-items-center justify-content-between" id="info-bar">
      <div class="col">
        <ul class="list-inline" style="margin-bottom:0px;display:inline">
            <li class="list-inline-item" id="meta-author"><i class="fa fa-pencil"></i> Jacob Williams</li>

            <li class="list-inline-item" id="statements"><i class="fa fa-list-ol"></i>
              <a data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-html="true"
                 title="10.9% of total for procedures.">163 statements</a>
            </li>

            <li class="list-inline-item" id="source-file">
              <i class="fa fa-code"></i>
              <a href="../src/ddeabm_module.F90"> Source File</a>
            </li>
        </ul>
      </div>
      <div class="col">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb justify-content-end mb-0">
                <li class="breadcrumb-item"><a href='../sourcefile/ddeabm_module.f90.html'>ddeabm_module.F90</a></li>
                <li class="breadcrumb-item"><a href='../module/ddeabm_module.html'>ddeabm_module</a></li>
            <li class="breadcrumb-item active" aria-current="page">ddeabm_with_event_wrapper</li>
          </ol>
        </nav>
      </div>
    </div>
  </div>
  <script>
    $(function () {
    $('[data-bs-toggle="tooltip"]').tooltip()
    })
  </script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
      <div id="sidebar">
      <h3>Contents</h3>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
    <div class="card card-primary">
      <div class="card-header text-left"><h3 class="card-title">Source Code</h3></div>
      <div class="list-group">
        <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper.html#src">ddeabm_with_event_wrapper</a>
      </div>
    </div>


  </div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>private  subroutine ddeabm_with_event_wrapper(me, t, y, tmax, tstop, idid, gval, integration_mode, tstep, continue)  
</h2>
    

    <p>Wrapper routine for <a href="../proc/ddeabm.html">ddeabm</a>, with event finding.
  It will integrate until <code>g(t,x)=0</code> or <code>t=tmax</code> (whichever comes first).
  Note that a root at the initial time is ignored (user should check for
  this manually)</p>
<p>If starting a new problem, must first call <code>me%first_call()</code>.</p>
<h3>See also</h3>
<ul>
<li>Inspired by <a href="http://www.netlib.no/netlib/ode/sderoot.f">sderoot</a>,
    but no code from that routine was used here.</li>
<li><a href="../proc/ddeabm_with_event_wrapper_vec.html">ddeabm_with_event_wrapper_vec</a> -- for vector <code>g</code> function</li>
</ul>
<div class="alert alert-info">
<p class="alert-title h4">Note</p>
<p>Currently not using the recommended tols if <code>idid=-2</code>.</p>
</div>

    <h3>Type Bound</h3>
    <p><a href='../type/ddeabm_with_event_class.html'>ddeabm_with_event_class</a></p>

    <h3>Arguments</h3>
        <table class="table table-striped varlist">
    <thead>
      <tr>
        <th scope="col">Type</th>
<th scope="col">Intent</th><th scope="col">Optional</th>        <th scope="col">Attributes</th>
        <th scope="col"></th>
        <th scope="col">Name</th>
        <th scope="col"></th>
    </thead>
    <tbody>
        <tr>
            <td>
              <span class="anchor" id="variable-me~14"></span>
              class(<a href='../type/ddeabm_with_event_class.html'>ddeabm_with_event_class</a>),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>me</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-t~6"></span>
              real(kind=wp),
            </td>
<td>intent(inout)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>t</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-y~2"></span>
              real(kind=wp),
            </td>
<td>intent(inout),</td>
              <td></td>            <td>
              dimension(me%neq)
            </td>
            <td>::</td>
            <td><strong>y</strong></td>
            <td>
                
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tmax"></span>
              real(kind=wp),
            </td>
<td>intent(in)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>tmax</strong></td>
            <td>
                <p>max time at which a solution is desired.
(if root not located, it will integrate to <code>tmax</code>)</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tstop~3"></span>
              real(kind=wp),
            </td>
<td>intent(in),</td>
              <td>optional</td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>tstop</strong></td>
            <td>
                <p>for some problems it may not be permissible to integrate
past a point <code>tstop</code> because a discontinuity occurs there
or the solution or its derivative is not defined beyond
<code>tstop</code>.  when you have declared a <code>tstop</code> point (see <code>info(4)</code>),
you have told the code not to integrate past <code>tstop</code>.
in this case any <code>tmax</code> beyond <code>tstop</code> is invalid input.
[not used if not present]</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-idid~2"></span>
              integer,
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>idid</strong></td>
            <td>
                <p>indicator reporting what the code did.
you must monitor this integer variable to
decide what action to take next.
<code>idid=1000</code> means a root was found.
See <a href="../proc/ddeabm.html">ddeabm</a> for other values.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-gval"></span>
              real(kind=wp),
            </td>
<td>intent(out)</td>
              <td></td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>gval</strong></td>
            <td>
                <p>value of the event function <code>g(t,x)</code> at the final time <code>t</code></p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-integration_mode~2"></span>
              integer,
            </td>
<td>intent(in),</td>
              <td>optional</td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>integration_mode</strong></td>
            <td>
                <p>Step mode:
<em>1</em> - normal integration from <code>t</code> to <code>tout</code>,
 no reporting [default].
<em>2</em> - normal integration from <code>t</code> to <code>tout</code>,
 report each step.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-tstep~2"></span>
              real(kind=wp),
            </td>
<td>intent(in),</td>
              <td>optional</td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>tstep</strong></td>
            <td>
                <p>Fixed time step to use for reporting and
evaluation of event function. If not present,
then default integrator steps are used.</p>
            </td>
        </tr>
        <tr>
            <td>
              <span class="anchor" id="variable-continue"></span>
              logical,
            </td>
<td>intent(in),</td>
              <td>optional</td>            <td>
              
            </td>
            <td>::</td>
            <td><strong>continue</strong></td>
            <td>
                <p>to continue after a previous event location.
This option can be used after a previous call to this routine
has found an event, to continue integration to the next event
without having to restart the integration. It will not report
the initial point (which would have been reported as the last
point of the previous call).</p>
            </td>
        </tr>
    </tbody>
  </table>

    <br>
    <div class="card">
      <div class="card-header">
  <h3 class="card-title">Calls</h3>
      </div>
      <div class="card-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: proc~~ddeabm_with_event_wrapper~~CallsGraph Pages: 1 -->
<svg id="procddeabm_with_event_wrapperCallsGraph" width="641pt" height="131pt"
 viewBox="0.00 0.00 641.00 131.46" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph" class="graph" transform="scale(0.56 0.56) rotate(0) translate(4 230)">
<title>proc~~ddeabm_with_event_wrapper~~CallsGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-230 1137,-230 1137,4 -4,4"/>
<!-- proc~ddeabm_with_event_wrapper -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node1" class="node">
<title>proc~ddeabm_with_event_wrapper</title>
<polygon fill="none" stroke="black" points="316,-126 0,-126 0,-102 316,-102 316,-126"/>
<text text-anchor="middle" x="158" y="-111.6" font-family="Helvetica,sans-Serif" font-size="10.50">ddeabm_with_event_class%ddeabm_with_event_wrapper</text>
</g>
<!-- info -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node2" class="node">
<title>info</title>
<polygon fill="#777777" stroke="#777777" points="450,-226 396,-226 396,-202 450,-202 450,-226"/>
<text text-anchor="middle" x="423" y="-211.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">info</text>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;info -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge1" class="edge">
<title>proc~ddeabm_with_event_wrapper&#45;&gt;info</title>
<path fill="none" stroke="#000000" d="M190.05,-126.02C228.15,-140.74 294.76,-166.4 352,-188 363.05,-192.17 375.1,-196.67 386.04,-200.73"/>
<polygon fill="#000000" stroke="#000000" points="385.12,-204.12 395.72,-204.31 387.55,-197.55 385.12,-204.12"/>
</g>
<!-- proc~ddeabm -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node3" class="node">
<title>proc~ddeabm</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node3"><a xlink:href="../proc/ddeabm.html" xlink:title="ddeabm_class%ddeabm">
<polygon fill="#d9534f" stroke="#d9534f" points="494,-146 352,-146 352,-122 494,-122 494,-146"/>
<text text-anchor="middle" x="423" y="-131.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddeabm_class%ddeabm</text>
</a>
</g>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;proc~ddeabm -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge2" class="edge">
<title>proc~ddeabm_with_event_wrapper&#45;&gt;proc~ddeabm</title>
<path fill="none" stroke="#000000" d="M316.16,-125.95C324.98,-126.62 333.63,-127.28 341.96,-127.91"/>
<polygon fill="#000000" stroke="#000000" points="341.7,-131.4 351.94,-128.67 342.23,-124.42 341.7,-131.4"/>
</g>
<!-- proc~ddeabm_interp -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node4" class="node">
<title>proc~ddeabm_interp</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node4"><a xlink:href="../proc/ddeabm_interp.html" xlink:title="ddeabm_class%ddeabm_interp">
<polygon fill="#d9534f" stroke="#d9534f" points="709,-66 530,-66 530,-42 709,-42 709,-66"/>
<text text-anchor="middle" x="619.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddeabm_class%ddeabm_interp</text>
</a>
</g>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;proc~ddeabm_interp -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge3" class="edge">
<title>proc~ddeabm_with_event_wrapper&#45;&gt;proc~ddeabm_interp</title>
<path fill="none" stroke="#000000" d="M275.08,-101.97C339.65,-94.9 421.4,-85.34 494,-75 509.22,-72.83 525.45,-70.28 540.98,-67.71"/>
<polygon fill="#000000" stroke="#000000" points="541.79,-71.12 551.08,-66.02 540.64,-64.22 541.79,-71.12"/>
</g>
<!-- proc~report_error -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node5" class="node">
<title>proc~report_error</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node5"><a xlink:href="../proc/report_error.html" xlink:title="report_error">
<polygon fill="#d9534f" stroke="#d9534f" points="849.5,-150 773.5,-150 773.5,-126 849.5,-126 849.5,-150"/>
<text text-anchor="middle" x="811.5" y="-135.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">report_error</text>
</a>
</g>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;proc~report_error -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge4" class="edge">
<title>proc~ddeabm_with_event_wrapper&#45;&gt;proc~report_error</title>
<path fill="none" stroke="#000000" d="M202.66,-126.01C241.5,-136.04 300.05,-149.54 352,-155 404.27,-160.49 706.42,-150.18 709,-150 726.74,-148.75 746.14,-146.64 763.19,-144.53"/>
<polygon fill="#000000" stroke="#000000" points="763.98,-147.96 773.46,-143.23 763.1,-141.02 763.98,-147.96"/>
</g>
<!-- report -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node6" class="node">
<title>report</title>
<polygon fill="#777777" stroke="#777777" points="450,-66 396,-66 396,-42 450,-42 450,-66"/>
<text text-anchor="middle" x="423" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">report</text>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;report -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge5" class="edge">
<title>proc~ddeabm_with_event_wrapper&#45;&gt;report</title>
<path fill="none" stroke="#000000" d="M211.91,-101.93C263.67,-90.12 341.11,-72.45 386.09,-62.19"/>
<polygon fill="#000000" stroke="#000000" points="387.01,-65.57 395.98,-59.94 385.45,-58.75 387.01,-65.57"/>
</g>
<!-- root_scalar -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node7" class="node">
<title>root_scalar</title>
<polygon fill="#777777" stroke="#777777" points="458.5,-24 387.5,-24 387.5,0 458.5,0 458.5,-24"/>
<text text-anchor="middle" x="423" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">root_scalar</text>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;root_scalar -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge6" class="edge">
<title>proc~ddeabm_with_event_wrapper&#45;&gt;root_scalar</title>
<path fill="none" stroke="#000000" d="M185.19,-101.97C221.98,-85.3 291.29,-54.78 352,-33 360.15,-30.07 368.94,-27.22 377.44,-24.6"/>
<polygon fill="#000000" stroke="#000000" points="378.67,-27.88 387.23,-21.64 376.64,-21.18 378.67,-27.88"/>
</g>
<!-- proc~ddeabm&#45;&gt;proc~report_error -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge8" class="edge">
<title>proc~ddeabm&#45;&gt;proc~report_error</title>
<path fill="none" stroke="#000000" d="M494.44,-134.73C572.36,-135.54 695.76,-136.81 762.99,-137.51"/>
<polygon fill="#000000" stroke="#000000" points="763.25,-141.01 773.29,-137.61 763.32,-134.01 763.25,-141.01"/>
</g>
<!-- proc~ddes -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node8" class="node">
<title>proc~ddes</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node8"><a xlink:href="../proc/ddes.html" xlink:title="ddeabm_class%ddes">
<polygon fill="#d9534f" stroke="#d9534f" points="681.5,-108 557.5,-108 557.5,-84 681.5,-84 681.5,-108"/>
<text text-anchor="middle" x="619.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddeabm_class%ddes</text>
</a>
</g>
</g>
<!-- proc~ddeabm&#45;&gt;proc~ddes -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge7" class="edge">
<title>proc~ddeabm&#45;&gt;proc~ddes</title>
<path fill="none" stroke="#000000" d="M485.54,-121.98C505.24,-118.13 527.22,-113.83 547.54,-109.86"/>
<polygon fill="#000000" stroke="#000000" points="548.22,-113.3 557.36,-107.95 546.87,-106.43 548.22,-113.3"/>
</g>
<!-- proc~dintp -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node9" class="node">
<title>proc~dintp</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node9"><a xlink:href="../proc/dintp.html" xlink:title="dintp">
<polygon fill="#d9534f" stroke="#d9534f" points="838.5,-66 784.5,-66 784.5,-42 838.5,-42 838.5,-66"/>
<text text-anchor="middle" x="811.5" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dintp</text>
</a>
</g>
</g>
<!-- proc~ddeabm_interp&#45;&gt;proc~dintp -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge9" class="edge">
<title>proc~ddeabm_interp&#45;&gt;proc~dintp</title>
<path fill="none" stroke="#000000" d="M709.1,-54C732.18,-54 755.76,-54 774.37,-54"/>
<polygon fill="#000000" stroke="#000000" points="774.43,-57.5 784.43,-54 774.43,-50.5 774.43,-57.5"/>
</g>
<!-- proc~ddes&#45;&gt;proc~report_error -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge12" class="edge">
<title>proc~ddes&#45;&gt;proc~report_error</title>
<path fill="none" stroke="#000000" d="M674.95,-108.04C702.95,-114.23 736.74,-121.7 763.58,-127.63"/>
<polygon fill="#000000" stroke="#000000" points="762.98,-131.08 773.5,-129.82 764.49,-124.25 762.98,-131.08"/>
</g>
<!-- proc~ddes&#45;&gt;proc~dintp -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge10" class="edge">
<title>proc~ddes&#45;&gt;proc~dintp</title>
<path fill="none" stroke="#000000" d="M674.95,-83.96C706.98,-76.88 746.59,-68.13 774.7,-61.91"/>
<polygon fill="#000000" stroke="#000000" points="775.49,-65.32 784.5,-59.75 773.98,-58.49 775.49,-65.32"/>
</g>
<!-- proc~dsteps -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node10" class="node">
<title>proc~dsteps</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node10"><a xlink:href="../proc/dsteps.html" xlink:title="ddeabm_class%dsteps">
<polygon fill="#d9534f" stroke="#d9534f" points="878,-108 745,-108 745,-84 878,-84 878,-108"/>
<text text-anchor="middle" x="811.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddeabm_class%dsteps</text>
</a>
</g>
</g>
<!-- proc~ddes&#45;&gt;proc~dsteps -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge11" class="edge">
<title>proc~ddes&#45;&gt;proc~dsteps</title>
<path fill="none" stroke="#000000" d="M681.66,-96C698.53,-96 717.03,-96 734.63,-96"/>
<polygon fill="#000000" stroke="#000000" points="734.86,-99.5 744.86,-96 734.86,-92.5 734.86,-99.5"/>
</g>
<!-- proc~dhstrt -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node11" class="node">
<title>proc~dhstrt</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node11"><a xlink:href="../proc/dhstrt.html" xlink:title="ddeabm_class%dhstrt">
<polygon fill="#d9534f" stroke="#d9534f" points="1043,-108 914,-108 914,-84 1043,-84 1043,-108"/>
<text text-anchor="middle" x="978.5" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ddeabm_class%dhstrt</text>
</a>
</g>
</g>
<!-- proc~dsteps&#45;&gt;proc~dhstrt -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge13" class="edge">
<title>proc~dsteps&#45;&gt;proc~dhstrt</title>
<path fill="none" stroke="#000000" d="M878.19,-96C886.56,-96 895.17,-96 903.65,-96"/>
<polygon fill="#000000" stroke="#000000" points="903.92,-99.5 913.92,-96 903.92,-92.5 903.92,-99.5"/>
</g>
<!-- proc~dhvnrm -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node12" class="node">
<title>proc~dhvnrm</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node12"><a xlink:href="../proc/dhvnrm.html" xlink:title="dhvnrm">
<polygon fill="#d94e8f" stroke="#d94e8f" points="1133,-108 1079,-108 1079,-84 1133,-84 1133,-108"/>
<text text-anchor="middle" x="1106" y="-93.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">dhvnrm</text>
</a>
</g>
</g>
<!-- proc~dhstrt&#45;&gt;proc~dhvnrm -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge14" class="edge">
<title>proc~dhstrt&#45;&gt;proc~dhvnrm</title>
<path fill="none" stroke="#000000" d="M1043.35,-96C1052.11,-96 1060.84,-96 1068.86,-96"/>
<polygon fill="#000000" stroke="#000000" points="1068.93,-99.5 1078.93,-96 1068.93,-92.5 1068.93,-99.5"/>
</g>
</g>
</svg>
</div>                <script>
                  var panprocddeabm_with_event_wrapperCallsGraph = svgPanZoom('#procddeabm_with_event_wrapperCallsGraph',
                    {zoomEnabled: true, controlIconsEnabled: true, fit: true, center: true,}
                  );
                </script>          <div>
            <a type="button" class="graph-help" data-bs-toggle="modal" href="#CallsGraph-help-text">Help</a>
          </div>
          <div class="modal fade" id="CallsGraph-help-text" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
<p>Nodes of different colours represent the following: </p>
<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="641pt" height="28pt"
 viewBox="0.00 0.00 641.00 27.51" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(0.86 0.86) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-28 741.5,-28 741.5,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node">
<title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="70,-24 0,-24 0,0 70,0 70,-24"/>
<text text-anchor="middle" x="35" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node">
<title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="146,-24 88,-24 88,0 146,0 146,-24"/>
<text text-anchor="middle" x="117" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node">
<title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="225.5,-24 164.5,-24 164.5,0 225.5,0 225.5,-24"/>
<text text-anchor="middle" x="195" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Type Bound Procedure -->
<g id="node4" class="node">
<title>Type Bound Procedure</title>
<polygon fill="#a7506f" stroke="#a7506f" points="374,-24 244,-24 244,0 374,0 374,-24"/>
<text text-anchor="middle" x="309" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Type Bound Procedure</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node5" class="node">
<title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="537.5,-24 392.5,-24 392.5,0 537.5,0 537.5,-24"/>
<text text-anchor="middle" x="465" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node6" class="node">
<title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="614,-24 556,-24 556,0 614,0 614,-24"/>
<text text-anchor="middle" x="585" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node7" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="737.5,-24 632.5,-24 632.5,0 737.5,0 737.5,-24"/>
<text text-anchor="middle" x="685" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

<p>Solid arrows point from a procedure to one which it calls. Dashed 
arrows point from an interface to procedures which implement that interface.
This could include the module procedures in a generic interface or the
implementation in a submodule of an interface in a parent module.
</p>
 </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br>


    
    

    
    



    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl codehilite"><pre><span></span><span class="w">   </span><span class="k">subroutine </span><span class="n">ddeabm_with_event_wrapper</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">tmax</span><span class="p">,</span><span class="w"> </span><span class="n">tstop</span><span class="p">,</span><span class="w"> </span><span class="n">idid</span><span class="p">,</span><span class="w"> </span><span class="n">gval</span><span class="p">,</span><span class="w"> </span><span class="n">integration_mode</span><span class="p">,</span><span class="w"> </span><span class="n">tstep</span><span class="p">,</span><span class="w"> </span><span class="k">continue</span><span class="p">)</span>

<span class="w">      </span><span class="k">implicit none</span>

<span class="k">      class</span><span class="p">(</span><span class="n">ddeabm_with_event_class</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w">   </span><span class="kd">::</span><span class="w"> </span><span class="n">me</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w">                         </span><span class="kd">::</span><span class="w"> </span><span class="n">t</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w">       </span><span class="kd">::</span><span class="w"> </span><span class="n">y</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">                            </span><span class="kd">::</span><span class="w"> </span><span class="n">tmax</span><span class="w">    </span><span class="c">!! max time at which a solution is desired.</span>
<span class="w">                                                              </span><span class="c">!! (if root not located, it will integrate to `tmax`)</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="w">                   </span><span class="kd">::</span><span class="w"> </span><span class="n">tstop</span><span class="w">   </span><span class="c">!! for some problems it may not be permissible to integrate</span>
<span class="w">                                                              </span><span class="c">!! past a point `tstop` because a discontinuity occurs there</span>
<span class="w">                                                              </span><span class="c">!! or the solution or its derivative is not defined beyond</span>
<span class="w">                                                              </span><span class="c">!! `tstop`.  when you have declared a `tstop` point (see `info(4)`),</span>
<span class="w">                                                              </span><span class="c">!! you have told the code not to integrate past `tstop`.</span>
<span class="w">                                                              </span><span class="c">!! in this case any `tmax` beyond `tstop` is invalid input.</span>
<span class="w">                                                              </span><span class="c">!! [not used if not present]</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">                            </span><span class="kd">::</span><span class="w"> </span><span class="n">idid</span><span class="w">    </span><span class="c">!! indicator reporting what the code did.</span>
<span class="w">                                                              </span><span class="c">!! you must monitor this integer variable to</span>
<span class="w">                                                              </span><span class="c">!! decide what action to take next.</span>
<span class="w">                                                              </span><span class="c">!! `idid=1000` means a root was found.</span>
<span class="w">                                                              </span><span class="c">!! See [[ddeabm]] for other values.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w">                           </span><span class="kd">::</span><span class="w"> </span><span class="n">gval</span><span class="w">    </span><span class="c">!! value of the event function `g(t,x)` at the final time `t`</span>
<span class="w">      </span><span class="kt">integer</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">integration_mode</span><span class="w">           </span><span class="c">!! Step mode:</span>
<span class="w">                                                              </span><span class="c">!! *1* - normal integration from `t` to `tout`,</span>
<span class="w">                                                              </span><span class="c">!!  no reporting [default].</span>
<span class="w">                                                              </span><span class="c">!! *2* - normal integration from `t` to `tout`,</span>
<span class="w">                                                              </span><span class="c">!!  report each step.</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tstep</span><span class="w">    </span><span class="c">!! Fixed time step to use for reporting and</span>
<span class="w">                                             </span><span class="c">!! evaluation of event function. If not present,</span>
<span class="w">                                             </span><span class="c">!! then default integrator steps are used.</span>
<span class="w">      </span><span class="kt">logical</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="w"> </span><span class="k">optional</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="k">continue</span><span class="w"> </span><span class="c">!! to continue after a previous event location.</span>
<span class="w">                                            </span><span class="c">!! This option can be used after a previous call to this routine</span>
<span class="w">                                            </span><span class="c">!! has found an event, to continue integration to the next event</span>
<span class="w">                                            </span><span class="c">!! without having to restart the integration. It will not report</span>
<span class="w">                                            </span><span class="c">!! the initial point (which would have been reported as the last</span>
<span class="w">                                            </span><span class="c">!! point of the previous call).</span>

<span class="w">      </span><span class="c">! local variables:</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">y1</span><span class="w">  </span><span class="c">!! initial state in an interval</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">y2</span><span class="w">  </span><span class="c">!! final state in an interval</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">dimension</span><span class="p">(:),</span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">yc</span><span class="w">  </span><span class="c">!! interpolated state at `tc`</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">g1</span><span class="w">          </span><span class="c">!! value of event function at `t1`</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">g2</span><span class="w">          </span><span class="c">!! value of event function at `t2`</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">t1</span><span class="w">          </span><span class="c">!! initial time of an interval</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">t2</span><span class="w">          </span><span class="c">!! final time of an interval</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">tzero</span><span class="w">       </span><span class="c">!! time where an event occurs in `[t1,t2]`</span>
<span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iflag</span><span class="w">        </span><span class="c">!! root finder status flag</span>
<span class="w">      </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">first</span><span class="w">        </span><span class="c">!! flag for the first step</span>
<span class="w">      </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">mode</span><span class="w">         </span><span class="c">!! local copy of integration_mode</span>
<span class="w">      </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">fixed_step</span><span class="w">   </span><span class="c">!! if using the fixed step size `tstep`</span>
<span class="w">      </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">last</span><span class="w">         </span><span class="c">!! for fixed step size: the last step</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dt</span><span class="w">          </span><span class="c">!! for fixed step size: actual signed time step</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">direction</span><span class="w">   </span><span class="c">!! direction of integration for</span>
<span class="w">                            </span><span class="c">!! fixed step size: `+1: dt&gt;=0`, `-1: dt&lt;0`</span>
<span class="w">      </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">continuing</span><span class="w">   </span><span class="c">!! local copy of optional `continue` argument</span>
<span class="w">      </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">first_dt</span><span class="w">    </span><span class="c">!! for fixed step size: the `dt` for the</span>
<span class="w">                            </span><span class="c">!! first step  (can differ from `dt` if</span>
<span class="w">                            </span><span class="c">!! continuing from a previous event solve)</span>
<span class="w">      </span><span class="kt">logical</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">root_found</span><span class="w">   </span><span class="c">!! if a root was found</span>

<span class="w">      </span><span class="c">! work arrays:</span>
<span class="w">      </span><span class="k">allocate</span><span class="p">(</span><span class="n">y1</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">))</span>
<span class="w">      </span><span class="k">allocate</span><span class="p">(</span><span class="n">y2</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">))</span>
<span class="w">      </span><span class="k">allocate</span><span class="p">(</span><span class="n">yc</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">))</span>

<span class="w">      </span><span class="c">! optional inputs:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">integration_mode</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">integration_mode</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">         </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">!default</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="k">continue</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="w">         </span><span class="c">! if there has not yet been a successful</span>
<span class="w">         </span><span class="c">! step yet, then proceed as normal without</span>
<span class="w">         </span><span class="c">! continuing. Otherwise, enable continue mode.</span>
<span class="w">         </span><span class="n">continuing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">continue</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">x_saved</span><span class="p">))</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">         </span><span class="n">continuing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">      </span><span class="k">end if</span>

<span class="w">      </span><span class="c">! if we are reporting the output at a fixed step size:</span>
<span class="w">      </span><span class="n">fixed_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">present</span><span class="p">(</span><span class="n">tstep</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">direction</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="w"> </span><span class="n">tmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t</span><span class="p">)</span>
<span class="w">         </span><span class="n">dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tstep</span><span class="p">)</span>
<span class="w">         </span><span class="n">first_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dt</span>
<span class="w">         </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">      </span><span class="k">end if</span>

<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">continuing</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">         </span><span class="c">! if continuing, then we reset the t,y inputs</span>
<span class="w">         </span><span class="c">! to the values from the last successful step</span>
<span class="w">         </span><span class="c">! (note than an event may have been found in the</span>
<span class="w">         </span><span class="c">! last call, so the input values are not correct)</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">! we need the first step to be from the</span>
<span class="w">            </span><span class="c">! last reported point, not the last</span>
<span class="w">            </span><span class="c">! successful step:</span>
<span class="w">            </span><span class="n">first_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">t_saved</span>
<span class="w">            </span><span class="c">! make sure not a 0 dt or in the wrong direction:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first_dt</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="w"> </span><span class="n">first_dt</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="w"> </span><span class="n">dt</span><span class="p">))</span><span class="w"> </span><span class="n">first_dt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dt</span>
<span class="w">         </span><span class="k">end if</span>
<span class="k">         </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">t_saved</span>
<span class="w">         </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">x_saved</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">   </span><span class="c">! necessary? (does not seem to matter)</span>
<span class="w">      </span><span class="k">end if</span>

<span class="w">      </span><span class="c">!check for invalid inputs:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="s1">&#39;integration_mode must be 1 or 2.&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="n">idid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">33</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>
<span class="k">      if</span><span class="w"> </span><span class="p">((</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="nb">associated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">)))</span><span class="w"> </span><span class="k">then</span>
<span class="k">         call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="s1">&#39;REPORT procedure must be associated for integration_mode=2.&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="n">idid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">33</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>

<span class="w">      </span><span class="c">!make sure the event function was set:</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="nb">associated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">         call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="s1">&#39;the event function GFUNC has not been associated.&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">         </span><span class="n">idid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">33</span>
<span class="w">         </span><span class="k">return</span>
<span class="k">      end if</span>

<span class="w">      </span><span class="c">!set info array:</span>

<span class="w">      </span><span class="c">!info(1) is set when ddeabm_new_problem is called</span>

<span class="w">      </span><span class="c">!info(2)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">scalar_tols</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">      </span><span class="k">end if</span>

<span class="w">      </span><span class="c">!info(3)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="c">!return after integrating to the specified (fixed step) time</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="w">  </span><span class="c">!intermediate output mode: return after each default step</span>
<span class="w">      </span><span class="k">end if</span>

<span class="w">      </span><span class="c">!info(4)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">tstop</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">tstop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tstop</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">         </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">tstop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w"> </span><span class="c">!not used</span>
<span class="w">      </span><span class="k">end if</span>

<span class="w">      </span><span class="c">!make a copy of the tols, since the routine might change them:</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">rtol_tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">rtol</span>
<span class="w">      </span><span class="n">me</span><span class="p">%</span><span class="n">atol_tmp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">atol</span>

<span class="w">      </span><span class="c">!evaluate the event function at the initial point:</span>
<span class="w">      </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span><span class="w">  </span><span class="c">!to avoid catching a root at the initial time</span>
<span class="w">      </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">      </span><span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span>
<span class="w">      </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">g1</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">continuing</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w">  </span><span class="c">!initial point</span>

<span class="w">      </span><span class="k">do</span>

<span class="k">         if</span><span class="w"> </span><span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">            </span><span class="c">! take one step to t2 and return</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">first_dt</span>
<span class="w">            </span><span class="k">else</span>
<span class="k">               </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">dt</span>
<span class="w">            </span><span class="k">end if</span>
<span class="k">            </span><span class="n">last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="o">*</span><span class="p">(</span><span class="n">tmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="w">  </span><span class="c">! if last point</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmax</span><span class="w">  </span><span class="c">! adjust last time step if necessary</span>
<span class="w">         </span><span class="k">else</span>
<span class="k">            </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tmax</span><span class="w">  </span><span class="c">! take a step in the direction of tmax and return</span>
<span class="w">         </span><span class="k">end if</span>

<span class="w">         </span><span class="c">!call the lower-level routine:</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">ddeabm</span><span class="p">(</span><span class="n">neq</span><span class="o">=</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">tout</span><span class="o">=</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">info</span><span class="o">=</span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">rtol</span><span class="o">=</span><span class="n">me</span><span class="p">%</span><span class="n">rtol_tmp</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">atol</span><span class="o">=</span><span class="n">me</span><span class="p">%</span><span class="n">atol_tmp</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">idid</span><span class="o">=</span><span class="n">idid</span><span class="p">)</span>

<span class="w">         </span><span class="c">! if there was an integration error (see ddeabm or idid codes):</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">idid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">exit</span>

<span class="w">         </span><span class="c">!if there was a user-triggered error:</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            </span><span class="n">idid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1000</span>
<span class="w">            </span><span class="k">exit</span>
<span class="k">         end if</span>

<span class="w">         </span><span class="c">!save the last successful step in the class:</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">t_saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">         </span><span class="n">me</span><span class="p">%</span><span class="n">x_saved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span>

<span class="w">         </span><span class="c">!evaluate event function at new point:</span>
<span class="w">         </span><span class="n">t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span>
<span class="w">         </span><span class="n">y2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="n">g2</span><span class="p">)</span>

<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">first</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">tol</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>

<span class="w">            </span><span class="c">! ignore a root at the initial time (first point)</span>
<span class="w">            </span><span class="c">! (or if continuing integration from a previous root)</span>

<span class="w">            </span><span class="c">! warning: is this check always sufficient? or</span>
<span class="w">            </span><span class="c">!          is it possible for zeroin to have</span>
<span class="w">            </span><span class="c">!          converged to a root outside this tol?</span>

<span class="w">         </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="n">g1</span><span class="o">*</span><span class="n">g2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0.0_wp</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! change in sign of the event function</span>

<span class="w">            </span><span class="n">root_found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>

<span class="w">            </span><span class="c">! the user bracket function can impose</span>
<span class="w">            </span><span class="c">! additional constraints on the root, so</span>
<span class="w">            </span><span class="c">! we check that now if it was associated:</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">bracket</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">root_found</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">me</span><span class="p">%</span><span class="n">bracket</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="n">y2</span><span class="p">,</span><span class="w"> </span><span class="n">g1</span><span class="p">,</span><span class="w"> </span><span class="n">g2</span><span class="p">)</span>
<span class="w">            </span><span class="k">end if</span>

<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">root_found</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">               </span><span class="c">! root somewhere on [t1,t2]</span>
<span class="w">               </span><span class="c">! call the root finder:</span>
<span class="w">               </span><span class="k">call </span><span class="n">root_scalar</span><span class="p">(</span><span class="n">root_method_brent</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">fun</span><span class="o">=</span><span class="n">zeroin_func</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">ax</span><span class="o">=</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">bx</span><span class="o">=</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">rtol</span><span class="o">=</span><span class="n">me</span><span class="p">%</span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">ftol</span><span class="o">=</span><span class="n">me</span><span class="p">%</span><span class="n">tol</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">xzero</span><span class="o">=</span><span class="n">tzero</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">fzero</span><span class="o">=</span><span class="n">gval</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">iflag</span><span class="o">=</span><span class="n">iflag</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">fax</span><span class="o">=</span><span class="n">g1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                </span><span class="n">fbx</span><span class="o">=</span><span class="n">g2</span><span class="p">)</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">iflag</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="c">! root found at tzero</span>
<span class="w">                  </span><span class="n">idid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1000</span><span class="w"> </span><span class="c">! root found</span>
<span class="w">                  </span><span class="c">!evaluate again to get the final state for output:</span>
<span class="w">                  </span><span class="n">gval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zeroin_func</span><span class="p">(</span><span class="n">tzero</span><span class="p">)</span>
<span class="w">                  </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tzero</span>
<span class="w">                  </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yc</span>
<span class="w">                  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="c">! report this point</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               else</span>
<span class="w">                  </span><span class="c">! unlikely to occur since zeroin is</span>
<span class="w">                  </span><span class="c">! &quot;guaranteed&quot; to converge, but just in case:</span>
<span class="w">                  </span><span class="k">call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="s1">&#39;Error locating root.&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">                  </span><span class="n">idid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2000</span><span class="w"> </span><span class="c">! no root is found</span>
<span class="w">                  </span><span class="k">return</span>
<span class="k">               end if</span>
<span class="k">            end if</span>

<span class="k">         end if</span>

<span class="w">         </span><span class="c">! report this point:</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">mode</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>

<span class="w">         </span><span class="c">! integration is finished (see ddeabm or idid codes):</span>
<span class="w">         </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">last</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="k">         else</span>
<span class="k">            if</span><span class="w"> </span><span class="p">(</span><span class="n">idid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">idid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="k">return</span>
<span class="k">         end if</span>

<span class="w">         </span><span class="c">! set up for next step:</span>
<span class="w">         </span><span class="n">first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">         </span><span class="n">g1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">g2</span>
<span class="w">         </span><span class="n">t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t2</span>
<span class="w">         </span><span class="n">y1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y2</span>

<span class="w">      </span><span class="k">end do</span>

<span class="k">   contains</span>

<span class="k">      function </span><span class="n">zeroin_func</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span><span class="w"> </span><span class="k">result</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

<span class="w">        </span><span class="c">!! evaluate the g function at `tc`</span>
<span class="w">        </span><span class="c">!! using interpolation ([[dintp]]).</span>

<span class="w">         </span><span class="k">implicit none</span>

<span class="k">         </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w">  </span><span class="kd">::</span><span class="w"> </span><span class="n">tc</span><span class="w">  </span><span class="c">!! current time</span>
<span class="w">         </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span><span class="w">             </span><span class="kd">::</span><span class="w"> </span><span class="n">g</span><span class="w">   </span><span class="c">!! value of event function</span>

<span class="w">         </span><span class="c">! interpolate to get the state at tc:</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">interpolate</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="p">)</span>

<span class="w">         </span><span class="c">! user defined event function:</span>
<span class="w">         </span><span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span><span class="w"> </span><span class="n">yc</span><span class="p">,</span><span class="w"> </span><span class="n">g</span><span class="p">)</span>

<span class="w">      </span><span class="k">end function </span><span class="n">zeroin_func</span>

<span class="w">   </span><span class="k">end subroutine </span><span class="n">ddeabm_with_event_wrapper</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

      <hr>
    </div> <!-- /container -->
    <footer>
      <div class="container">
        <div class="row justify-content-between">
          <div class="col">
            <p>
              ddeabm
 was developed by Jacob Williams<br>              &copy; 2025 
</p>
          </div>
          <div class="col">
            <p class="text-end">
              Documentation generated by
              <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
            </p>
          </div>
        </div>
        <br>
      </div> <!-- /container -->
    </footer>

    <!-- Bootstrap core JavaScript -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>    

    <!-- MathJax JavaScript
             ================================================== -->
             <!-- Placed at the end of the document so the pages load faster -->
        <script type="text/x-mathjax-config">
          MathJax.Hub.Config({
          TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
          jax: ['input/TeX','input/MathML','output/HTML-CSS'],
          extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
          });
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

          <script src="../tipuesearch/tipuesearch_content.js"></script>
          <script src="../tipuesearch/tipuesearch_set.js"></script>
          <script src="../tipuesearch/tipuesearch.js"></script>

  </body>
</html>