<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	 
	 <meta name="description" content="Modern Fortran Implementation of the DDEABM Adams-Bashforth-Moulton ODE Solver">
    
    <meta name="author" content="Jacob Williams" >
    <link rel="icon" href="../favicon.png">

    <title>ddeabm_with_event_wrapper &ndash; ddeabm</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">ddeabm </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
				
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
		 aria-expanded="false">Contents <span class="caret"></span></a>
	      <ul class="dropdown-menu">
              
            <li><a href="../lists/files.html">Source Files</a></li>
				
				
            <li><a href="../lists/modules.html">Modules</a></li>
				
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
				
				
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
								
            <li><a href="../lists/types.html">Derived Types</a></li>
				
				
            </ul>
            </li>

<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>ddeabm_with_event_wrapper
      <small>Subroutine</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     <li><i class="fa fa-pencil"></i> Jacob Williams</li>
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
	  data-placement="bottom" data-html="true"
	  title=" 9.8% of total for procedures.">153 statements</a>
     </li> 
     
     
    <li><i class="fa fa-code"></i><a href="../src/ddeabm_module.f90"> Source File</a></li>
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
     <li><a href='../sourcefile/ddeabm_module.f90.html'>ddeabm_module.f90</a></li>
  
     <li><a href='../module/ddeabm_module.html'>ddeabm_module</a></li>
  
     <li class="active">ddeabm_with_event_wrapper</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper.html#src">ddeabm_with_event_wrapper</a>
  </div>
</div>


  <hr>
  

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-0">All Procedures</a></h3></div>
  <div id="allprocs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/bracket_function_default.html">bracket_function_default</a>
      
      <a class="list-group-item" href="../proc/ddeabm.html">ddeabm</a>
      
      <a class="list-group-item" href="../proc/ddeabm_initialize.html">ddeabm_initialize</a>
      
      <a class="list-group-item" href="../proc/ddeabm_interp.html">ddeabm_interp</a>
      
      <a class="list-group-item" href="../proc/ddeabm_new_problem.html">ddeabm_new_problem</a>
      
      <a class="list-group-item" href="../proc/ddeabm_stop_integration.html">ddeabm_stop_integration</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_initialize.html">ddeabm_with_event_initialize</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_initialize_vec.html">ddeabm_with_event_initialize_vec</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper.html">ddeabm_with_event_wrapper</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper_vec.html">ddeabm_with_event_wrapper_vec</a>
      
      <a class="list-group-item" href="../proc/ddeabm_wrapper.html">ddeabm_wrapper</a>
      
      <a class="list-group-item" href="../proc/ddes.html">ddes</a>
      
      <a class="list-group-item" href="../proc/destroy_ddeabm.html">destroy_ddeabm</a>
      
      <a class="list-group-item" href="../proc/dhstrt.html">dhstrt</a>
      
      <a class="list-group-item" href="../proc/dhvnrm.html">dhvnrm</a>
      
      <a class="list-group-item" href="../proc/dintp.html">dintp</a>
      
      <a class="list-group-item" href="../proc/dsteps.html">dsteps</a>
      
      <a class="list-group-item" href="../proc/report_error.html">report_error</a>
      
      <a class="list-group-item" href="../proc/zeroin.html">zeroin</a>
      
    </div>
  </div>
</div>


</div>  

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>
private subroutine ddeabm_with_event_wrapper(me, t, y, tmax, tstop, idid, gval, integration_mode, tstep, continue)
    
    
	 
</h2>
    
  


    
    <p>Wrapper routine for <a href="../proc/ddeabm.html">ddeabm</a>, with event finding.
  It will integrate until <code>g(t,x)=0</code> or <code>t=tmax</code> (whichever comes first).
  Note that a root at the initial time is ignored (user should check for
  this manually)</p>
<p>If starting a new problem, must first call <code>me%first_call()</code>.</p>
<h3>See also</h3>
<ul>
<li>Inspired by <a href="http://www.netlib.no/netlib/ode/sderoot.f">sderoot</a>,
    but no code from that routine was used here.</li>
<li><a href="../proc/ddeabm_with_event_wrapper_vec.html">ddeabm_with_event_wrapper_vec</a> -- for vector <code>g</code> function</li>
</ul>
<p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>Currently not using the recommended tols if <code>idid=-2</code>.</p></div>
    

    <h3>Arguments</h3>
    
      
<table class="table table-striped varlist">
<thead><tr><th>Type</th>
<th>Intent</th><th>Optional</th>
<th>Attributes</th><th></th><th>Name</th><th></th></thead>



<tbody>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-me%7E14"></span>class(<a href='../type/ddeabm_with_event_class.html'>ddeabm_with_event_class</a>),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>me</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-t%7E7"></span>real(kind=wp),</td>
  <td>intent(inout)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>t</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-y%7E2"></span>real(kind=wp),</td>
  <td>intent(inout),</td>
  <td></td>
  
  <td>dimension(me%neq)</td><td>::</td>
  <td><strong>y</strong></td><td></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-tmax"></span>real(kind=wp),</td>
  <td>intent(in)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>tmax</strong></td><td><p>max time at which a solution is desired.
 (if root not located, it will integrate to <code>tmax</code>)</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-tstop%7E3"></span>real(kind=wp),</td>
  <td>intent(in),</td>
  <td>optional</td>
  
  <td></td><td>::</td>
  <td><strong>tstop</strong></td><td><p>for some problems it may not be permissible to integrate
 past a point <code>tstop</code> because a discontinuity occurs there
 or the solution or its derivative is not defined beyond
 <code>tstop</code>.  when you have declared a <code>tstop</code> point (see <code>info(4)</code>),
 you have told the code not to integrate past <code>tstop</code>.
 in this case any <code>tmax</code> beyond <code>tstop</code> is invalid input.
 [not used if not present]</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-idid%7E2"></span>integer,</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>idid</strong></td><td><p>indicator reporting what the code did.
 you must monitor this integer variable to
 decide what action to take next.
 <code>idid=1000</code> means a root was found.
 See <a href="../proc/ddeabm.html">ddeabm</a> for other values.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-gval"></span>real(kind=wp),</td>
  <td>intent(out)</td>
  <td></td>
  
  <td></td><td>::</td>
  <td><strong>gval</strong></td><td><p>value of the event function <code>g(t,x)</code> at the final time <code>t</code></p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-integration_mode%7E2"></span>integer,</td>
  <td>intent(in),</td>
  <td>optional</td>
  
  <td></td><td>::</td>
  <td><strong>integration_mode</strong></td><td><p>Step mode:
 <em>1</em> - normal integration from <code>t</code> to <code>tout</code>, no reporting [default].
 <em>2</em> - normal integration from <code>t</code> to <code>tout</code>, report each step.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-tstep%7E2"></span>real(kind=wp),</td>
  <td>intent(in),</td>
  <td>optional</td>
  
  <td></td><td>::</td>
  <td><strong>tstep</strong></td><td><p>Fixed time step to use for reporting and
 evaluation of event function. If not present,
 then default integrator steps are used.</p></td>
  
</tr>

  
  
  
  
<tr>
  
  <td><span class="anchor" id="variable-continue"></span>logical,</td>
  <td>intent(in),</td>
  <td>optional</td>
  
  <td></td><td>::</td>
  <td><strong>continue</strong></td><td><p>to continue after a previous event location.
 This option can be used after a previous call to this routine
 has found an event, to continue integration to the next event
 without having to restart the integration. It will not report
 the initial point (which would have been reported as the last
 point of the previous call).</p></td>
  
</tr>

</tbody>
</table>

    
    
    
     <h3>Calls</h3>
     
                <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: proc~~ddeabm_with_event_wrapper~~CallsGraph Pages: 1 -->
<svg id="procddeabm_with_event_wrapperCallsGraph" width="268pt" height="74pt"
 viewBox="0.00 0.00 268.00 74.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 70)">
<title>proc~~ddeabm_with_event_wrapper~~CallsGraph</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-70 264,-70 264,4 -4,4"/>
<!-- proc~ddeabm_with_event_wrapper -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node1" class="node"><title>proc~ddeabm_with_event_wrapper</title>
<polygon fill="none" stroke="black" points="154,-45 0,-45 0,-21 154,-21 154,-45"/>
<text text-anchor="middle" x="77" y="-30.6" font-family="Helvetica,sans-Serif" font-size="10.50">ddeabm_with_event_wrapper</text>
</g>
<!-- proc~zeroin -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node2" class="node"><title>proc~zeroin</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node2"><a xlink:href="../proc/zeroin.html" xlink:title="zeroin">
<polygon fill="#d9534f" stroke="#d9534f" points="252,-66 198,-66 198,-42 252,-42 252,-66"/>
<text text-anchor="middle" x="225" y="-51.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">zeroin</text>
</a>
</g>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;proc~zeroin -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge1" class="edge"><title>proc~ddeabm_with_event_wrapper&#45;&gt;proc~zeroin</title>
<path fill="none" stroke="#000000" d="M154.421,-43.992C165.993,-45.6566 177.451,-47.3046 187.627,-48.7683"/>
<polygon fill="#000000" stroke="#000000" points="187.322,-52.2604 197.719,-50.2198 188.319,-45.3317 187.322,-52.2604"/>
</g>
<!-- proc~report_error -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_node3" class="node"><title>proc~report_error</title>
<g id="a_proc~~ddeabm_with_event_wrapper~~CallsGraph_node3"><a xlink:href="../proc/report_error.html" xlink:title="report_error">
<polygon fill="#d9534f" stroke="#d9534f" points="260,-24 190,-24 190,-0 260,-0 260,-24"/>
<text text-anchor="middle" x="225" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">report_error</text>
</a>
</g>
</g>
<!-- proc~ddeabm_with_event_wrapper&#45;&gt;proc~report_error -->
<g id="proc~~ddeabm_with_event_wrapper~~CallsGraph_edge2" class="edge"><title>proc~ddeabm_with_event_wrapper&#45;&gt;proc~report_error</title>
<path fill="none" stroke="#000000" d="M154.421,-22.008C163.153,-20.752 171.819,-19.5054 179.919,-18.3404"/>
<polygon fill="#000000" stroke="#000000" points="180.439,-21.8018 189.839,-16.9136 179.442,-14.8731 180.439,-21.8018"/>
</g>
</g>
</svg>
</div>
                <div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div>
                <div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog">
                  <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="-graph-help-label">Graph Key</h4>
                      </div>
                      <div class="modal-body">
                        
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.36.0 (20140111.2315)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="559pt" height="32pt"
 viewBox="0.00 0.00 559.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-28 555,-28 555,4 -4,4"/>
<!-- Subroutine -->
<g id="node1" class="node"><title>Subroutine</title>
<polygon fill="#d9534f" stroke="#d9534f" points="64,-24 0,-24 0,-0 64,-0 64,-24"/>
<text text-anchor="middle" x="32" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Subroutine</text>
</g>
<!-- Function -->
<g id="node2" class="node"><title>Function</title>
<polygon fill="#d94e8f" stroke="#d94e8f" points="136,-24 82,-24 82,-0 136,-0 136,-24"/>
<text text-anchor="middle" x="109" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Function</text>
</g>
<!-- Interface -->
<g id="node3" class="node"><title>Interface</title>
<polygon fill="#a7506f" stroke="#a7506f" points="209.25,-24 154.75,-24 154.75,-0 209.25,-0 209.25,-24"/>
<text text-anchor="middle" x="182" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Interface</text>
</g>
<!-- Unknown Procedure Type -->
<g id="node4" class="node"><title>Unknown Procedure Type</title>
<polygon fill="#777777" stroke="#777777" points="364,-24 228,-24 228,-0 364,-0 364,-24"/>
<text text-anchor="middle" x="296" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Unknown Procedure Type</text>
</g>
<!-- Program -->
<g id="node5" class="node"><title>Program</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="436,-24 382,-24 382,-0 436,-0 436,-24"/>
<text text-anchor="middle" x="409" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Program</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node6" class="node"><title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="551.25,-24 454.75,-24 454.75,-0 551.25,-0 551.25,-24"/>
<text text-anchor="middle" x="503" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a procedure to one which it calls. Dashed 
    arrows point from an interface to procedures which implement that interface.
    This could include the module procedures in a generic interface or the
    implementation in a submodule of an interface in a parent module.
    </p>
    
                      </div>
                    </div>
                  </div>
                </div>
                
     
     
    <br>

    <section class="visible-xs visible-sm hidden-md">
      




















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper.html#src">ddeabm_with_event_wrapper</a>
  </div>
</div>


    </section>
    <br class="visible-xs visible-sm hidden-md">

    

    
    
    
    
    

    
    
    
    
    


    
    
    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span>    <span class="k">subroutine </span><span class="n">ddeabm_with_event_wrapper</span><span class="p">(</span><span class="n">me</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">tmax</span><span class="p">,</span><span class="n">tstop</span><span class="p">,</span><span class="n">idid</span><span class="p">,</span><span class="n">gval</span><span class="p">,</span><span class="n">integration_mode</span><span class="p">,</span><span class="n">tstep</span><span class="p">,</span><span class="k">continue</span><span class="p">)</span>

    <span class="k">implicit none</span>

<span class="k">    class</span><span class="p">(</span><span class="n">ddeabm_with_event_class</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>   <span class="kd">::</span> <span class="n">me</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>                         <span class="kd">::</span> <span class="n">t</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span>       <span class="kd">::</span> <span class="n">y</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">tmax</span>    <span class="c">!! max time at which a solution is desired.</span>
                                                              <span class="c">!! (if root not located, it will integrate to `tmax`)</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span>                   <span class="kd">::</span> <span class="n">tstop</span>   <span class="c">!! for some problems it may not be permissible to integrate</span>
                                                              <span class="c">!! past a point `tstop` because a discontinuity occurs there</span>
                                                              <span class="c">!! or the solution or its derivative is not defined beyond</span>
                                                              <span class="c">!! `tstop`.  when you have declared a `tstop` point (see `info(4)`),</span>
                                                              <span class="c">!! you have told the code not to integrate past `tstop`.</span>
                                                              <span class="c">!! in this case any `tmax` beyond `tstop` is invalid input.</span>
                                                              <span class="c">!! [not used if not present]</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                            <span class="kd">::</span> <span class="n">idid</span>    <span class="c">!! indicator reporting what the code did.</span>
                                                              <span class="c">!! you must monitor this integer variable to</span>
                                                              <span class="c">!! decide what action to take next.</span>
                                                              <span class="c">!! `idid=1000` means a root was found.</span>
                                                              <span class="c">!! See [[ddeabm]] for other values.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>                           <span class="kd">::</span> <span class="n">gval</span>    <span class="c">!! value of the event function `g(t,x)` at the final time `t`</span>
    <span class="kt">integer</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">integration_mode</span>           <span class="c">!! Step mode:</span>
                                                              <span class="c">!! *1* - normal integration from `t` to `tout`, no reporting [default].</span>
                                                              <span class="c">!! *2* - normal integration from `t` to `tout`, report each step.</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="n">tstep</span>    <span class="c">!! Fixed time step to use for reporting and</span>
                                             <span class="c">!! evaluation of event function. If not present,</span>
                                             <span class="c">!! then default integrator steps are used.</span>
    <span class="kt">logical</span><span class="p">,</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">),</span><span class="k">optional</span> <span class="kd">::</span> <span class="k">continue</span> <span class="c">!! to continue after a previous event location.</span>
                                            <span class="c">!! This option can be used after a previous call to this routine</span>
                                            <span class="c">!! has found an event, to continue integration to the next event</span>
                                            <span class="c">!! without having to restart the integration. It will not report</span>
                                            <span class="c">!! the initial point (which would have been reported as the last</span>
                                            <span class="c">!! point of the previous call).</span>

    <span class="c">!local variables:</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tzero</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iflag</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">first</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">)</span> <span class="kd">::</span> <span class="n">y1</span><span class="p">,</span><span class="n">y2</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">dimension</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">)</span> <span class="kd">::</span> <span class="n">yc</span>  <span class="c">!! interpolated state at tc</span>
    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">mode</span>  <span class="c">!! local copy of integration_mode</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">fixed_step</span> <span class="c">!! if using the fixed step size `tstep`</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">last</span> <span class="c">!! for fixed step size: the last step</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dt</span>  <span class="c">!! for fixed step size: actual signed time step</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">direction</span> <span class="c">!! direction of integration for</span>
                          <span class="c">!! fixed step size: +1: dt&gt;=0, -1: dt&lt;0</span>
    <span class="kt">logical</span> <span class="kd">::</span> <span class="n">continuing</span> <span class="c">!! local copy of optional `continue` argument</span>
    <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">first_dt</span> <span class="c">!! for fixed step size: the `dt` for the</span>
                         <span class="c">!! first step  (can differ from `dt` if</span>
                         <span class="c">!! continuing from a previous event solve)</span>

    <span class="c">!optional input:</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">integration_mode</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        </span><span class="n">mode</span> <span class="o">=</span> <span class="n">integration_mode</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c">!default</span>
    <span class="k">end if</span>
<span class="k">    if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="k">continue</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        </span><span class="n">continuing</span> <span class="o">=</span> <span class="k">continue</span>
<span class="k">    else</span>
<span class="k">        </span><span class="n">continuing</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">end if</span>

    <span class="c">! if we are reporting the output at a fixed step size:</span>
    <span class="n">fixed_step</span> <span class="o">=</span> <span class="nb">present</span><span class="p">(</span><span class="n">tstep</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">direction</span> <span class="o">=</span> <span class="nb">sign</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="n">tmax</span><span class="o">-</span><span class="n">t</span><span class="p">)</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">direction</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">tstep</span><span class="p">)</span>
        <span class="n">first_dt</span> <span class="o">=</span> <span class="n">dt</span>
        <span class="n">last</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
    <span class="k">end if</span>

    <span class="c">! if continuing, then we reset the t,y inputs</span>
    <span class="c">! to the values from the last successful step</span>
    <span class="c">! (note than an event may have been found in the</span>
    <span class="c">! last call, so the input values aren&#39;t correct)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">continuing</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        if</span> <span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">x_saved</span><span class="p">))</span> <span class="k">then</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span> <span class="k">then</span>
                <span class="c">! we need the first step to be from the</span>
                <span class="c">! last reported point, not the last</span>
                <span class="c">! successful step:</span>
                <span class="n">first_dt</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span> <span class="o">-</span> <span class="n">me</span><span class="p">%</span><span class="n">t_saved</span>
                <span class="c">! make sure not a 0 dt or in the wrong direction:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">first_dt</span><span class="o">==</span><span class="mf">0.0_wp</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="nb">sign</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="n">first_dt</span><span class="p">)</span><span class="o">/=</span><span class="nb">sign</span><span class="p">(</span><span class="mf">1.0_wp</span><span class="p">,</span><span class="n">dt</span><span class="p">))</span> <span class="n">first_dt</span> <span class="o">=</span> <span class="n">dt</span>
            <span class="k">end if</span>
<span class="k">            </span><span class="n">t</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">t_saved</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">x_saved</span>
            <span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span> <span class="c">! necessary? (doesn&#39;t seem to matter)</span>
        <span class="k">else</span>
            <span class="c">! haven&#39;t had a successful step yet, so proceed as normal</span>
        <span class="k">end if</span>
<span class="k">    end if</span>

    <span class="c">!check for invalid inputs:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">/=</span><span class="mi">1</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">mode</span><span class="o">/=</span><span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                            <span class="s1">&#39;integration_mode must be 1 or 2.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">idid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">33</span>
        <span class="k">return</span>
<span class="k">    end if</span>
<span class="k">    if</span> <span class="p">((</span><span class="n">mode</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">)))</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                            <span class="s1">&#39;REPORT procedure must be associated for integration_mode=2.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">idid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">33</span>
        <span class="k">return</span>
<span class="k">    end if</span>

    <span class="c">!make sure the event function was set:</span>
    <span class="k">if</span> <span class="p">(.</span><span class="nb">not</span><span class="p">.</span> <span class="nb">associated</span><span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        call </span><span class="n">report_error</span><span class="p">(</span><span class="s1">&#39;ddeabm_with_event_wrapper&#39;</span><span class="p">,</span> <span class="p">&amp;</span>
                            <span class="s1">&#39;the event function GFUNC has not been associated.&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">idid</span><span class="o">=-</span><span class="mi">33</span>
        <span class="k">return</span>
<span class="k">    end if</span>

    <span class="c">!set info array:</span>

    <span class="c">!info(1) is set when ddeabm_new_problem is called</span>

    <span class="c">!info(2)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">scalar_tols</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">end if</span>

    <span class="c">!info(3)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span> <span class="k">then</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c">!return after integrating to the specified (fixed step) time</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c">!intermediate output mode: return after each default step</span>
    <span class="k">end if</span>

    <span class="c">!info(4)</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">present</span><span class="p">(</span><span class="n">tstop</span><span class="p">))</span> <span class="k">then</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">me</span><span class="p">%</span><span class="n">tstop</span> <span class="o">=</span> <span class="n">tstop</span>
    <span class="k">else</span>
<span class="k">        </span><span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">me</span><span class="p">%</span><span class="n">tstop</span> <span class="o">=</span> <span class="mf">0.0_wp</span> <span class="c">!not used</span>
    <span class="k">end if</span>

    <span class="c">!make a copy of the tols, since the routine might change them:</span>
    <span class="n">me</span><span class="p">%</span><span class="n">rtol_tmp</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">rtol</span>
    <span class="n">me</span><span class="p">%</span><span class="n">atol_tmp</span> <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">atol</span>

    <span class="c">!evaluate the event function at the initial point:</span>
    <span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">true</span><span class="p">.</span>  <span class="c">!to avoid catching a root at the initial time</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">t</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">g1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">==</span><span class="mi">2</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="p">.</span><span class="nb">not</span><span class="p">.</span> <span class="n">continuing</span><span class="p">)</span> <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>  <span class="c">!initial point</span>

    <span class="k">do</span>

<span class="k">        if</span> <span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span> <span class="k">then</span>
            <span class="c">! take one step to t2 and return</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="k">then</span>
<span class="k">                </span><span class="n">t2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">first_dt</span>
            <span class="k">else</span>
<span class="k">                </span><span class="n">t2</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span>
            <span class="k">end if</span>
<span class="k">            </span><span class="n">last</span> <span class="o">=</span> <span class="n">direction</span><span class="o">*</span><span class="p">(</span><span class="n">tmax</span><span class="o">-</span><span class="n">t2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.0_wp</span>  <span class="c">! if last point</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">tmax</span>  <span class="c">! adjust last time step if necessary</span>
        <span class="k">else</span>
<span class="k">            </span><span class="n">t2</span> <span class="o">=</span> <span class="n">tmax</span>  <span class="c">! take a step in the direction of tmax and return</span>
        <span class="k">end if</span>

        <span class="c">!call the lower-level routine:</span>
        <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">ddeabm</span><span class="p">(</span> <span class="n">neq</span>     <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">neq</span><span class="p">,&amp;</span>
                          <span class="n">t</span>     <span class="o">=</span> <span class="n">t</span><span class="p">,&amp;</span>
                          <span class="n">y</span>     <span class="o">=</span> <span class="n">y</span><span class="p">,&amp;</span>
                          <span class="n">tout</span>  <span class="o">=</span> <span class="n">t2</span><span class="p">,&amp;</span>
                          <span class="n">info</span>  <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">info</span><span class="p">,&amp;</span>
                          <span class="n">rtol</span>  <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">rtol_tmp</span><span class="p">,&amp;</span>
                          <span class="n">atol</span>  <span class="o">=</span> <span class="n">me</span><span class="p">%</span><span class="n">atol_tmp</span><span class="p">,&amp;</span>
                          <span class="n">idid</span>  <span class="o">=</span> <span class="n">idid</span><span class="p">)</span>

        <span class="c">! if there was an integration error (see ddeabm or idid codes):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idid</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">exit</span>

        <span class="c">!if there was a user-triggered error:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">error</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            </span><span class="n">idid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1000</span>
            <span class="k">exit</span>
<span class="k">        end if</span>

        <span class="c">!save the last successful step in the class:</span>
        <span class="n">me</span><span class="p">%</span><span class="n">t_saved</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">me</span><span class="p">%</span><span class="n">x_saved</span> <span class="o">=</span> <span class="n">y</span>

        <span class="c">!evaluate event function at new point:</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">t</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">g2</span><span class="p">)</span>

        <span class="c">! !check status (see ddeabm or idid codes):</span>
        <span class="c">! if (fixed_step) then</span>
        <span class="c">!     ! fixed step to t2</span>
        <span class="c">!     if (last) then</span>
        <span class="c">!         !tmax was reached. check it for root</span>
        <span class="c">!         gval = g2</span>
        <span class="c">!         if (abs(gval)&lt;=me%tol) idid = 1000 !root found</span>
        <span class="c">!         if (mode==2) call me%report(t,y)  !final point</span>
        <span class="c">!         return</span>
        <span class="c">!     else</span>
        <span class="c">!         select case (idid)</span>
        <span class="c">!         case(2,3)</span>
        <span class="c">!             !intermediate step successful, continue</span>
        <span class="c">!         case default</span>
        <span class="c">!             !some error</span>
        <span class="c">!             return</span>
        <span class="c">!         end select</span>
        <span class="c">!     end if</span>
        <span class="c">! else</span>
        <span class="c">!     ! default steps in direction of t2</span>
        <span class="c">!     select case (idid)</span>
        <span class="c">!     case(1)</span>
        <span class="c">!         !intermediate step successful, continue</span>
        <span class="c">!     case(2,3)</span>
        <span class="c">!         !tmax was reached. check it for root</span>
        <span class="c">!         gval = g2</span>
        <span class="c">!         if (abs(gval)&lt;=me%tol) idid = 1000 !root found</span>
        <span class="c">!         if (mode==2) call me%report(t,y)  !final point</span>
        <span class="c">!         return</span>
        <span class="c">!     case default</span>
        <span class="c">!         !some error</span>
        <span class="c">!         return</span>
        <span class="c">!     end select</span>
        <span class="c">! end if</span>

        <span class="c">! if (abs(g2)&lt;=me%tol) then  !intermediate t2 is a root</span>

        <span class="c">!     idid = 1000</span>
        <span class="c">!     gval = g2</span>
        <span class="c">!     t = t2</span>
        <span class="c">!     y = y2</span>
        <span class="c">!     if (mode==2) call me%report(t,y)</span>
        <span class="c">!     return</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">first</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="nb">abs</span><span class="p">(</span><span class="n">g1</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">me</span><span class="p">%</span><span class="n">tol</span><span class="p">)</span> <span class="k">then</span>

            <span class="c">! ignore a root at the initial time</span>
            <span class="c">! (or if continuing integration from a previous root)</span>

            <span class="c">! warning: is this check always sufficient? or</span>
            <span class="c">!          is it possible for zeroin to have</span>
            <span class="c">!          converged to a root outside this tol?</span>

            <span class="c">!ignore this root</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

        <span class="n">elseif</span> <span class="p">(</span><span class="n">me</span><span class="p">%</span><span class="n">bracket</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">))</span> <span class="k">then</span>

            <span class="c">! root somewhere on [t1,t2]</span>
            <span class="c">! note: we ignore if a root on the initial time</span>

            <span class="c">!call the root finder:</span>
            <span class="k">call </span><span class="n">zeroin</span><span class="p">(</span><span class="n">zeroin_func</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">me</span><span class="p">%</span><span class="n">tol</span><span class="p">,</span><span class="n">tzero</span><span class="p">,</span><span class="n">gval</span><span class="p">,</span><span class="n">iflag</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">iflag</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">then</span> <span class="c">!root found at tzero</span>
                <span class="n">idid</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="c">!evaluate again to get the final state for output:</span>
                <span class="n">gval</span> <span class="o">=</span> <span class="n">zeroin_func</span><span class="p">(</span><span class="n">tzero</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">tzero</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">yc</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">mode</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
                <span class="k">return</span>
<span class="k">            else</span>
                <span class="c">! unlikely to occur since zeroin is &quot;guaranteed&quot; to converge...</span>
                <span class="k">write</span><span class="p">(</span><span class="o">*</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="s1">&#39;Error locating root in ddeabm_with_event_wrapper.&#39;</span>
                <span class="n">idid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2000</span> <span class="c">! if no root is found</span>
                <span class="k">return</span>
<span class="k">            end if</span>

<span class="k">        else</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">mode</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span> <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
        <span class="k">end if</span>

        <span class="c">! integration is finished (see ddeabm or idid codes):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fixed_step</span><span class="p">)</span> <span class="k">then</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="k">return</span>
<span class="k">        else</span>
<span class="k">            if</span> <span class="p">(</span><span class="n">idid</span><span class="o">==</span><span class="mi">2</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="n">idid</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span> <span class="k">return</span>
<span class="k">        end if</span>

        <span class="c">!set up for next step:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
        <span class="n">g1</span> <span class="o">=</span> <span class="n">g2</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">t2</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y2</span>

    <span class="k">end do</span>

<span class="k">    contains</span>

<span class="k">        function </span><span class="n">zeroin_func</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span> <span class="k">result</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>

        <span class="c">!! evaluate the g function at `tc` using interpolation ([[dintp]]).</span>

        <span class="k">implicit none</span>

<span class="k">        </span><span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">),</span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span>  <span class="kd">::</span> <span class="n">tc</span>  <span class="c">!! current time</span>
        <span class="kt">real</span><span class="p">(</span><span class="n">wp</span><span class="p">)</span>             <span class="kd">::</span> <span class="n">g</span>   <span class="c">!! value of event function</span>

        <span class="c">! write(*,*) &#39;&#39;</span>
        <span class="c">! write(*,*) &#39;me%ypout : &#39;, me%ypout</span>
        <span class="c">! write(*,*) &#39;me%neq : &#39;, me%neq</span>
        <span class="c">! write(*,*) &#39;me%kold : &#39;, me%kold</span>
        <span class="c">! write(*,*) &#39;me%phi  : &#39;, me%phi</span>
        <span class="c">! write(*,*) &#39;me%ivc : &#39;, me%ivc</span>
        <span class="c">! write(*,*) &#39;me%iv : &#39;, me%iv</span>
        <span class="c">! write(*,*) &#39;me%kgi : &#39;, me%kgi</span>
        <span class="c">! write(*,*) &#39;me%gi : &#39;, me%gi</span>
        <span class="c">! write(*,*) &#39;me%alpha : &#39;, me%alpha</span>
        <span class="c">! write(*,*) &#39;me%g : &#39;, me%g</span>
        <span class="c">! write(*,*) &#39;me%w : &#39;, me%w</span>
        <span class="c">! write(*,*) &#39;me%xold : &#39;, me%xold</span>
        <span class="c">! write(*,*) &#39;me%p : &#39;, me%p</span>
        <span class="c">! write(*,*) &#39;&#39;</span>

        <span class="c">! interpolate to get the state at tc:</span>
        <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">ddeabm_interp</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">tc</span><span class="p">,</span><span class="n">yc</span><span class="p">)</span>
        <span class="c">! call dintp(t2,y2,tc,yc,&amp;</span>
        <span class="c">!                 me%ypout,me%neq,me%kold,me%phi,&amp;     !! class variables</span>
        <span class="c">!                 me%ivc,me%iv,me%kgi,me%gi,me%alpha,&amp;</span>
        <span class="c">!                 me%g,me%w,me%xold,me%p)</span>

        <span class="c">! user defined event function:</span>
        <span class="k">call </span><span class="n">me</span><span class="p">%</span><span class="n">gfunc</span><span class="p">(</span><span class="n">tc</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">g</span><span class="p">)</span>

        <span class="k">end function </span><span class="n">zeroin_func</span>

    <span class="k">end subroutine </span><span class="n">ddeabm_with_event_wrapper</span>
</pre></div>

    </section>
    <br>
    
    
    </div>
  </div>

  <section class="visible-xs visible-sm hidden-md">
    <hr>
    

<div class="panel panel-default">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#allprocs-1">All Procedures</a></h3></div>
  <div id="allprocs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../proc/bracket_function_default.html">bracket_function_default</a>
      
      <a class="list-group-item" href="../proc/ddeabm.html">ddeabm</a>
      
      <a class="list-group-item" href="../proc/ddeabm_initialize.html">ddeabm_initialize</a>
      
      <a class="list-group-item" href="../proc/ddeabm_interp.html">ddeabm_interp</a>
      
      <a class="list-group-item" href="../proc/ddeabm_new_problem.html">ddeabm_new_problem</a>
      
      <a class="list-group-item" href="../proc/ddeabm_stop_integration.html">ddeabm_stop_integration</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_initialize.html">ddeabm_with_event_initialize</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_initialize_vec.html">ddeabm_with_event_initialize_vec</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper.html">ddeabm_with_event_wrapper</a>
      
      <a class="list-group-item" href="../proc/ddeabm_with_event_wrapper_vec.html">ddeabm_with_event_wrapper_vec</a>
      
      <a class="list-group-item" href="../proc/ddeabm_wrapper.html">ddeabm_wrapper</a>
      
      <a class="list-group-item" href="../proc/ddes.html">ddes</a>
      
      <a class="list-group-item" href="../proc/destroy_ddeabm.html">destroy_ddeabm</a>
      
      <a class="list-group-item" href="../proc/dhstrt.html">dhstrt</a>
      
      <a class="list-group-item" href="../proc/dhvnrm.html">dhvnrm</a>
      
      <a class="list-group-item" href="../proc/dintp.html">dintp</a>
      
      <a class="list-group-item" href="../proc/dsteps.html">dsteps</a>
      
      <a class="list-group-item" href="../proc/report_error.html">report_error</a>
      
      <a class="list-group-item" href="../proc/zeroin.html">zeroin</a>
      
    </div>
  </div>
</div>


  </section>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> ddeabm was developed by Jacob Williams</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js'],
        'HTML-CSS': { 
           styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: '#000000 ! important'} }
        }
      });
    </script>
    <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  </body>
</html>